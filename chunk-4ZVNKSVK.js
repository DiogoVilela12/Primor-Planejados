import{a as re}from"./chunk-SE2NCUBX.js";import{a as ne}from"./chunk-S3MWANP4.js";import{g as K,i as X,j as Z,k as S,l as ee,m as O,n as k,q as te}from"./chunk-BBWGYPE6.js";import{b as z,c as B,d as L,e as Q,f as U,g as R,h as $,j as Y,k as G,l as H,n as J}from"./chunk-RXS46TFZ.js";import"./chunk-WTIKVVTU.js";import{$a as y,Da as s,Ha as N,Jb as D,Kb as W,Ma as T,Nb as j,Qa as M,Qb as P,R as I,W as C,Wa as w,Xa as h,Za as o,_a as a,ab as E,bb as b,c as A,cb as g,da as m,db as d,ea as p,eb as F,hb as u,ib as f,jb as _,ua as V}from"./chunk-TPPPVHGH.js";import"./chunk-MKOOB2DY.js";import"./chunk-EZZN43H3.js";import{a as x,c as q,h as l}from"./chunk-2HP4JIPC.js";var v=class c{constructor(t,e,n,r){this.firestore=t;this.logsService=e;this.afAuth=n;this.platformId=r}getFerragens(){if(!P(this.platformId))return new A(e=>e.complete());let t=S(this.firestore,"ferragens");return X(t,{idField:"id"})}getFerragemById(t){return l(this,null,function*(){if(!P(this.platformId))return;let e=O(this.firestore,`ferragens/${t}`),n=yield k(e);if(n.exists())return x({id:n.id},n.data())})}checkAuth(){return l(this,null,function*(){return P(this.platformId)?(yield this.afAuth.currentUser)?!0:(console.warn("Usu\xE1rio n\xE3o autenticado - opera\xE7\xE3o bloqueada"),!1):!1})}addFerragem(t){return l(this,null,function*(){if(!(yield this.checkAuth()))return Promise.reject("Usu\xE1rio n\xE3o autenticado ou ambiente inv\xE1lido");let e=S(this.firestore,"ferragens"),n=(yield this.afAuth.currentUser)?.email??"desconhecido",r=this.logsService.logAction(`Adicionando Ferragem: Nome: ${t.nome}, Especifica\xE7\xE3o: ${t.especificacao}, Quantidade: ${t.quantidade}`,n,"ADD");return this.logsService.addLog(r),Z(e,t)})}deleteFerragem(t){return l(this,null,function*(){if(!(yield this.checkAuth()))return Promise.reject("Usu\xE1rio n\xE3o autenticado ou ambiente inv\xE1lido");let e=O(this.firestore,`ferragens/${t}`),r=(yield k(e)).data(),i=(yield this.afAuth.currentUser)?.email??"desconhecido";if(r){let oe=this.logsService.logAction(`Removendo Ferragem: Nome: ${r.nome}, Especifica\xE7\xE3o: ${r.especificacao}, Quantidade: ${r.quantidade}`,i,"REMOVE");this.logsService.addLog(oe)}return ee(e)})}updateFerragem(t,e,n){return l(this,null,function*(){if(!(yield this.checkAuth()))return Promise.reject("Usu\xE1rio n\xE3o autenticado ou ambiente inv\xE1lido");if(!e)throw new Error("ferragemAntiga is undefined");let r=(yield this.afAuth.currentUser)?.email??"desconhecido";this.logsService.addLog(this.logsService.logAction(`EDIT Ferragem: ${e.nome}, Especifica\xE7\xE3o: ${e.especificacao}, Quantidade: ${e.quantidade} 
        Para -> Nome: ${n.nome}, Especifica\xE7\xE3o: ${n.especificacao}, Quantidade: ${n.quantidade}`,r,"EDIT"));let i=O(this.firestore,`ferragens/${t}`);return te(i,n)})}static \u0275fac=function(e){return new(e||c)(C(K),C(ne),C(re),C(V))};static \u0275prov=I({token:c,factory:c.\u0275fac,providedIn:"root"})};function se(c,t){if(c&1&&y(0,"option",16),c&2){let e=t.$implicit;h("value",e)}}function de(c,t){if(c&1&&y(0,"option",16),c&2){let e=t.$implicit;h("value",e)}}function le(c,t){if(c&1){let e=E();o(0,"tr")(1,"td"),d(2),a(),o(3,"td"),d(4),a(),o(5,"td"),d(6),a(),o(7,"td")(8,"button",17),b("click",function(){let r=m(e).$implicit,i=g();return p(i.editar(r))}),d(9,"Editar"),a(),o(10,"button",18),b("click",function(){let r=m(e).$implicit,i=g();return p(i.excluir(r.id))}),d(11,"Excluir"),a()()()}if(c&2){let e=t.$implicit;s(2),F(e.nome),s(2),F(e.especificacao),s(2),F(e.quantidade)}}function ge(c,t){if(c&1){let e=E();o(0,"div",19)(1,"div",20)(2,"h3",21),d(3,"Editar Ferragem"),a(),o(4,"label",22)(5,"input",23),_("ngModelChange",function(r){m(e);let i=g();return f(i.ferragemEditando.nome,r)||(i.ferragemEditando.nome=r),p(r)}),a()(),o(6,"label",22)(7,"input",24),_("ngModelChange",function(r){m(e);let i=g();return f(i.ferragemEditando.especificacao,r)||(i.ferragemEditando.especificacao=r),p(r)}),a()(),o(8,"label",22)(9,"input",25),_("ngModelChange",function(r){m(e);let i=g();return f(i.ferragemEditando.quantidade,r)||(i.ferragemEditando.quantidade=r),p(r)}),a()(),o(10,"div",26)(11,"button",27),b("click",function(){m(e);let r=g();return p(r.salvarEdicao())}),d(12,"Salvar"),a(),o(13,"button",28),b("click",function(){m(e);let r=g();return p(r.cancelarEdicao())}),d(14,"Cancelar"),a()()()()}if(c&2){let e=g();s(5),u("ngModel",e.ferragemEditando.nome),s(2),u("ngModel",e.ferragemEditando.especificacao),s(2),u("ngModel",e.ferragemEditando.quantidade)}}var ie=class c{constructor(t){this.ferragemService=t}ferragens=[];novaFerragem=this.criarFerragemVazia();ferragemEditando=this.criarFerragemVazia();editando=!1;catalogoFerragens=[];catalogoEspecificacoes=[];termoBusca="";ngOnInit(){this.carregarFerragens()}adicionar(){if(!this.validaNome(this.novaFerragem.nome)||!this.validaQuantidade(this.novaFerragem.quantidade))return;let t=x({},this.novaFerragem);this.verificaExistente(t)?this.atualizarQuantidadeExistente(t):this.ferragemService.addFerragem(t).then(()=>{this.novaFerragem=this.criarFerragemVazia()})}editar(t){this.ferragemEditando=x({},t),this.editando=!0}cancelarEdicao(){this.editando=!1}salvarEdicao(){return l(this,null,function*(){if(!this.ferragemEditando.id)return;let r=this.ferragemEditando,{id:t}=r,e=q(r,["id"]),n=yield this.ferragemService.getFerragemById(t);this.ferragemService.updateFerragem(t,n,e).then(()=>{this.editando=!1})})}excluir(t){confirm("Tem certeza que deseja excluir esta ferragem?")&&this.ferragemService.deleteFerragem(t)}buscarFerragem(){let t=this.termoBusca.trim().toLowerCase();if(t==="")this.carregarFerragens(),console.log(this.ferragens.length);else{let e=this.ferragens.filter(n=>n.nome.toLowerCase().includes(t));e.length===0&&e.length!=this.ferragens.length?this.carregarFerragens():this.ferragens=e}}carregarFerragens(){this.ferragemService.getFerragens().subscribe(t=>{this.ferragens=t;let e=new Set(t.map(r=>r.nome));this.catalogoFerragens=Array.from(e);let n=new Set(t.map(r=>r.especificacao));this.catalogoEspecificacoes=Array.from(n)})}criarFerragemVazia(){return{nome:"",especificacao:"",quantidade:0}}atualizarQuantidadeExistente(t){this.ferragens.forEach(e=>l(this,null,function*(){if(e.nome===t.nome&&e.especificacao===t.especificacao){let n=yield this.ferragemService.getFerragemById(e.id);this.ferragemService.updateFerragem(e.id,n,{quantidade:Number(e.quantidade)+Number(t.quantidade)})}}))}validaNome(t){return!0}validaQuantidade(t){return Number(t)>0?!0:(alert("Quantidade deve ser maior que 0!"),!1)}verificaExistente(t){return this.ferragens.some(e=>e.nome===t.nome&&e.especificacao===t.especificacao)}static \u0275fac=function(e){return new(e||c)(N(v))};static \u0275cmp=T({type:c,selectors:[["app-ferragens"]],decls:30,vars:10,consts:[[1,"controle"],[1,"controle_title"],[1,"controle_container",3,"ngSubmit"],["name","nome","type","text","placeholder","Nome da Ferragem","required","",1,"controle_container_input",2,"flex","1",3,"ngModelChange","ngModel"],["id","catalogoFerragens_list",1,"catalogoFerragens_list"],["class","catalogoMDF_MDP_list_item",3,"value",4,"ngFor","ngForOf"],["name","nome","type","text","placeholder","Especifica\xE7\xE3o","required","",1,"controle_container_input",2,"flex","1",3,"ngModelChange","ngModel"],["id","catalogoEspecificacoes_list",1,"catalogoEspecificacoes_list"],["name","quantidade","type","number","placeholder","Quantidade","required","",1,"controle_container_input",2,"flex","1",3,"ngModelChange","ngModel"],["type","submit",1,"btn-adicionar"],[1,"controle_container"],["type","text","placeholder","Buscar Ferragem",1,"controle_container_input",3,"ngModelChange","input","ngModel"],[1,"scrollable-table"],[1,"tabela-madeiras"],[4,"ngFor","ngForOf"],["class","modal",4,"ngIf"],[1,"catalogoMDF_MDP_list_item",3,"value"],[1,"btn-editar",3,"click"],[1,"btn-excluir",3,"click"],[1,"modal"],[1,"modal-content"],[1,"modal-title"],[1,"modal-label"],["type","text","name","nome","placeholder","Nome da Ferragem","required","",1,"controle_container_input",3,"ngModelChange","ngModel"],["type","text","name","especificacao","placeholder","Especifica\xE7\xE3o","required","",1,"controle_container_input",3,"ngModelChange","ngModel"],["type","number","name","quantidade","placeholder","Quantidade","required","",1,"controle_container_input",3,"ngModelChange","ngModel"],[1,"modal-actions"],[1,"btn-salvar",3,"click"],[1,"btn-cancelar",3,"click"]],template:function(e,n){e&1&&(o(0,"section",0)(1,"h2",1),d(2,"Controle de Ferragens"),a(),o(3,"form",2),b("ngSubmit",function(){return n.adicionar()}),o(4,"input",3),_("ngModelChange",function(i){return f(n.novaFerragem.nome,i)||(n.novaFerragem.nome=i),i}),a(),o(5,"datalist",4),M(6,se,1,1,"option",5),a(),o(7,"input",6),_("ngModelChange",function(i){return f(n.novaFerragem.especificacao,i)||(n.novaFerragem.especificacao=i),i}),a(),o(8,"datalist",7),M(9,de,1,1,"option",5),a(),o(10,"input",8),_("ngModelChange",function(i){return f(n.novaFerragem.quantidade,i)||(n.novaFerragem.quantidade=i),i}),a(),o(11,"button",9),d(12,"Adicionar"),a()(),o(13,"div",10)(14,"input",11),_("ngModelChange",function(i){return f(n.termoBusca,i)||(n.termoBusca=i),i}),b("input",function(){return n.buscarFerragem()}),a()(),o(15,"div",12)(16,"table",13)(17,"thead")(18,"tr")(19,"th"),d(20,"Nome"),a(),o(21,"th"),d(22,"Especifica\xE7\xE3o"),a(),o(23,"th"),d(24,"Quantidade"),a(),o(25,"th"),d(26,"A\xE7\xF5es"),a()()(),o(27,"tbody"),M(28,le,12,3,"tr",14),a()()()(),M(29,ge,15,3,"div",15)),e&2&&(s(4),u("ngModel",n.novaFerragem.nome),w("list","catalogoFerragens_list"),s(2),h("ngForOf",n.catalogoFerragens),s(),u("ngModel",n.novaFerragem.especificacao),w("list","catalogoEspecificacoes_list"),s(2),h("ngForOf",n.catalogoEspecificacoes),s(),u("ngModel",n.novaFerragem.quantidade),s(4),u("ngModel",n.termoBusca),s(14),h("ngForOf",n.ferragens),s(),h("ngIf",n.editando))},dependencies:[j,D,W,J,R,Y,G,z,$,B,L,H,U,Q],styles:['.controle[_ngcontent-%COMP%]{background-color:#f9f9f9;margin:20px;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0000001a;display:flex;align-items:center;flex-direction:column;justify-content:center}.controle_title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:800;text-transform:uppercase;color:#222;margin-bottom:20px;position:relative;display:inline-block;letter-spacing:1px}.controle_title[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;bottom:-6px;width:100%;height:4px;background-color:#f39c12;border-radius:2px;transition:width .4s ease}.controle_container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-around;flex-direction:row;width:100%;gap:10px;margin-bottom:20px}.controle_container_input[_ngcontent-%COMP%]{background-color:#fff;color:#333;border:1px solid #ccc;width:100%;padding:10px;font-size:14px;border-radius:4px;appearance:none;-webkit-appearance:none;-moz-appearance:none;box-sizing:border-box;outline:none;transition:border-color .2s}.controle_container_input[_ngcontent-%COMP%]:focus{border-color:#2196f3}.controle_container_input[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:#222}.controle_container_tamanho[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-around;gap:10px;padding:16px}.form-input-search[_ngcontent-%COMP%]{padding:10px;border:1px solid #ccc;border-radius:4px;font-size:14px;display:flex;flex-direction:row;width:100%}.checkbox-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-around;margin-right:10px}.checkbox-container[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;width:18px;height:18px;border:2px solid #ccc;border-radius:4px;background-color:#fff;position:relative;cursor:pointer;transition:border-color .3s,background-color .3s}.checkbox-container[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked{background-color:#2196f3;border-color:#2196f3}.checkbox-container[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked:after{content:"";position:absolute;top:2px;left:6px;width:4px;height:9px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg)}.checkbox-container[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #2196f34d}.input-tamanho[_ngcontent-%COMP%]{width:80px}.input-quantidade[_ngcontent-%COMP%]{width:100px}.input-search[_ngcontent-%COMP%]{flex:1;min-width:150px}.select-madeira[_ngcontent-%COMP%]{min-width:120px}.tamanho-separador[_ngcontent-%COMP%]{margin:0 5px}.input-autocomplete[_ngcontent-%COMP%]{background-color:#fff;color:#333;border:1px solid #ccc;width:100%;padding:10px;font-size:14px;border-radius:4px;box-sizing:border-box;outline:none;transition:border-color .2s,box-shadow .2s}.input-autocomplete[_ngcontent-%COMP%]:focus{border-color:#2196f3;box-shadow:0 0 0 3px #2196f333}.btn-adicionar[_ngcontent-%COMP%], .btn-editar[_ngcontent-%COMP%], .btn-excluir[_ngcontent-%COMP%], .btn-salvar[_ngcontent-%COMP%], .btn-cancelar[_ngcontent-%COMP%], .btn-add[_ngcontent-%COMP%], .btn-search[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;font-size:14px;cursor:pointer;transition:background-color .3s}.btn-add[_ngcontent-%COMP%]{background-color:gray;color:#fff;width:100%}.btn-search[_ngcontent-%COMP%]{width:17.5%}.btn-adicionar[_ngcontent-%COMP%], .btn-salvar[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.btn-adicionar[_ngcontent-%COMP%]:hover, .btn-salvar[_ngcontent-%COMP%]:hover{background-color:#45a049}.btn-search[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff}.btn-search[_ngcontent-%COMP%]:hover{background-color:#0b7dda}.btn-editar[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff;margin:0 8px}.btn-editar[_ngcontent-%COMP%]:hover{background-color:#0b7dda}.btn-excluir[_ngcontent-%COMP%], .btn-cancelar[_ngcontent-%COMP%]{background-color:#f44336;color:#fff;margin:0 8px}.btn-excluir[_ngcontent-%COMP%]:hover, .btn-cancelar[_ngcontent-%COMP%]:hover{background-color:#da190b}.scrollable-table[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;margin-top:20px}.tabela-madeiras[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;min-width:600px}.tabela-madeiras[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabela-madeiras[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:10px;text-align:center}.tabela-madeiras[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f2f2f2;color:#333;width:20vw}.tabela-madeiras[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}.tabela-madeiras[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:999;padding:10px}.modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;padding:20px;max-width:750px;width:100%;box-shadow:0 6px 20px #00000040;animation:_ngcontent-%COMP%_slideIn .3s ease-in-out;display:flex;flex-direction:column}.modal-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:800;text-transform:uppercase;text-align:center;color:#222;margin-bottom:20px;position:relative;display:inline-block;letter-spacing:1px}.modal-title[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;bottom:-6px;width:100%;height:4px;background-color:#f39c12;border-radius:2px;transition:width .4s ease}.modal-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:20px;font-weight:700;color:#444}.modal_label_div[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;justify-content:center}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-top:10px}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}@media (max-width: 1000px){.controle_container[_ngcontent-%COMP%]{flex-direction:column}.modal-content[_ngcontent-%COMP%]{max-width:98vw}.tabela-madeiras[_ngcontent-%COMP%]{min-width:400px}.painel-madeiras[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]{padding:10px}.form-madeira[_ngcontent-%COMP%], .form-search[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.form-group[_ngcontent-%COMP%], .tamanho-group[_ngcontent-%COMP%], .input-tamanho[_ngcontent-%COMP%], .input-quantidade[_ngcontent-%COMP%], .input-search[_ngcontent-%COMP%], .select-madeira[_ngcontent-%COMP%]{width:100%;min-width:unset}.modal-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-adicionar[_ngcontent-%COMP%], .btn-search[_ngcontent-%COMP%], .btn-editar[_ngcontent-%COMP%], .btn-excluir[_ngcontent-%COMP%], .btn-salvar[_ngcontent-%COMP%], .btn-cancelar[_ngcontent-%COMP%]{width:100%;margin:5px 0}}']})};export{ie as FerragensComponent};
